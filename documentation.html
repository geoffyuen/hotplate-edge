<!DOCTYPE html>
<html lang="en" class="bg-dark-gray">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Tachyons Explorer</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <style>
        html, button, input, optgroup, select, textarea {
            font-family: Montserrat, sans-serif;
        }
        pre {
            tab-size:2;
            overflow-wrap: break-word;
            word-break: break-all;
            font-family: menlo, monospace;
        }
    </style>
</head>

<body>
    <div class="bg-blue shadow-2 pv4 sticky ma0 top-0 z-9999 flex items-center">
        <h1 class="ph4 ma0 lh-solid white fw3">Tachyons Explorer</h1>
        <div class="ph4 flex w-100 w-50-m">
            <input list="suggestions" id="filter" type="text" class="filter w-100 pv3 ph4 f3 bw0 lh-solid"
            placeholder="Type a Tachyons class or css rule. Click the card title to copy to clipboard.">
            <button id="clear" class="input-reset pv3 ph4 f3 bw0 bg-light-gray lh-solid">Clear</button>
        </div>
    </div>

    <div id="rules" class="flex flex-wrap f4"></div>

    <datalist id="suggestions">
        <option value="flexbox align- justify-">
        <option value="absolute top: left: right: bottom:">
    </datalist>

    <div id="alert" class="dn fixed pv2 ph4 bg-green white b br3" style="top: 50%; left: 50%; transform: translate(-50%, -50%)">Copied!</div>

    <!-- End body content -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min.js"></script>
    <script>
        var $rules = $('#rules');
        Array.prototype.forEach.call(document.styleSheets[0].cssRules, function (a) {
            // console.log(a.selectorText);
            var rule = GetStyle(a.selectorText);
            var text = a.selectorText + '';
            text = text.split(' ')[0].split(':')[0].replace('.','').replace(',','');
            if (rule.startsWith('.')) {
                rule = rule.replace(/{/g, '{\n\t').replace(/;/g, ';\n\t').replace(/\t }/g, '}');
                $rules.append('<div class="card flex-auto w-100 w-50-m w-third-l pa4"><div class="flex flex-column bg-white shadow-2 ba b--dark-gray br3 h-100 overflow-hidden"><h3 class="ma0 pv3 ph4 bg-black-05 pointer hover-blue" data-clipboard-text="' + text + '">' + text + '</h3><pre class="flex-auto light-pink bg-black-90 ma0 pv3 ph4">' + rule + '</pre></div></div>');
            }
        });

        function GetStyle(CLASSname) {
            var styleSheets = document.styleSheets;
            var styleSheetsLength = styleSheets.length;
            for (var i = 0; i < styleSheetsLength; i++) {
                if (styleSheets[i].rules) { var classes = styleSheets[i].rules; }
                else {
                    try { if (!styleSheets[i].cssRules) { continue; } }
                    //Note that SecurityError exception is specific to Firefox.
                    catch (e) { if (e.name == 'SecurityError') { console.log("SecurityError. Cant readd: " + styleSheets[i].href); continue; } }
                    var classes = styleSheets[i].cssRules;
                }
                for (var x = 0; x < classes.length; x++) {
                    if (classes[x].selectorText == CLASSname) {
                        var ret = (classes[x].cssText) ? classes[x].cssText : classes[x].style.cssText;
                        if (ret.indexOf(classes[x].selectorText) == -1) { ret = classes[x].selectorText + "{" + ret + "}"; }
                        return ret;
                    }
                }
            }
        }

        $("#filter").keyup(function () {
            var filter = $(this).val().trim().replace(/ /g,'|');
            //console.log(filter);
            $("#rules .card").each(function () {
                var $this = $(this);
                if (($this.text()).match(new RegExp(filter,'g'))) {
                    $this.css({ 'display': 'block' });
                } else {
                    $this.css({ 'display': 'none' });
                }
            });
        });
        $('#clear').click(function(){
            $('#filter').val('').focus().trigger('keyup');
        });

        var clipboard = new ClipboardJS('#rules h3');
        clipboard.on('success', function(e) {
            //console.info('Action:', e.action);
            console.info('Text:', e.text);
            //console.info('Trigger:', e.trigger);
            e.clearSelection();
            $('#alert').text(e.text + ' copied!').fadeIn(200, function(){
                $(this).fadeOut(1000);
            });
        });
    </script>
</body>

</html>