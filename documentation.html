<!DOCTYPE html>
<html lang="en" class="bg-gray">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Tachyons Explorer</title>
    <link id="tachyons" rel="stylesheet" href="style.css">
    <link href="//fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <style>
        html, button, input, optgroup, select, textarea {
            font-family: Montserrat, sans-serif;
        }
        pre {
            tab-size:2;
            font-family: menlo, monospace;
        }
    </style>
</head>
<script>
    var suggestions = {
        "color": "{\\s+color:",
        "background-color": "(\\.bg-).*(\\s+background-color)",
        "border": "\\s+border",
        "border-color": "\\s+border-color",
        "display": "\\s+display:",
        "height": "\\s+height:",
        "margin": "\\s+margin",
        "max-width": "\\s+max-width:",
        "min-height": "\\s+min-height:",
        "min-width": "\\s+min-width:",
        "padding": "\\s+padding",
        "position": "\\s+(position:|top:|left:|right:|bottom:)",
        "width": "\\s+width:",
        "flexbox": "\\s+(flexbox|align-|justify-|order)",
        "table": "(table|collapse|striped)",
        "clip": "clip",
        "font-family": "font-family",
        "font-size": "font-size",
        "font-style": "font-style",
        "font-weight": "font-weight",
        "overflow": "overflow",
        "text-align": "text-align",
        "text-decoration": "text-decoration",
        "truncate": "truncate",
        "vertical-align": "vertical-align",
        "white-space": "white-space",
        "word-break": "word-break",
        "z-index": "z-index"
    };
</script>
<body>

    <div class="flex-m flex-l">

        <!-- sidebar -->
        <div class="w-100 w-25-m w-25-l bg-white shadow-2 top-0 min-vh-100-m min-vh-100-l">
            <div class="sticky top-0">
                <div class="bg-blue pa4">
                    <h1 class="mt0 mb4 lh-solid white fw3 f1">Tachyons Explorer</h1>
                    <div class="mb4 flex flex-wrap">
                        <div class="w-100 flex">
                            <div class="polyfill">
                                <input list="suggestions" id="filter" type="text" class="filter w-100 pv3 ph3 f3 bw0 lh-solid"
                                    placeholder="words (or) or regex">
                            </div>
                            <datalist id="suggestions">
                                <script>
                                    for (var key in suggestions) {
                                        document.write('<option value="' + suggestions[key] + '" label="' + key + '">');
                                    }
                                </script>
                            </datalist>
                            <button id="clear" class="input-reset pv0 ph3 bw0 bg-light-gray lh-solid hover-bg-black hover-white f1">Ã—</button>
                        </div>
                    </div>
                </div>
                <div class="pa4 dn db-m db-l f4">
                    <div id="csscontainer" class="pb4 w-100 dn db-m db-l">
                        <label><input type="radio" name="css" value="#outer" checked> Outer</label>
                        <label class="ml4"><input id="cssinner" type="radio" name="css" value="#inner"> Inner</label>
                    </div>
                    <div id="outer" class="" style="position: sticky; top 0; outline: 1px dotted gray">
                        Outer
                        <div id="inner" class="" style="outline: 1px dashed darkgray">Inner: Lorem ipsum dolor sit amet
                            consectetur adipisicing elit. Tempore,
                            quas. Commodi cum sint maiores impedit, perspiciatis excepturi quod rem beatae dicta
                            temporibus ea assumenda minus necessitatibus sed iste nesciunt ullam!</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- main area -->
        <div class="w-100 w-75-m w-75-l f4">
            <div id="rules" class="flex flex-wrap pa4"></div>
        </div>

    </div>


    <template id="rule_template">
        <article class="card flex-auto w-100 w-50-m w-50-l pa4">

            <div class="flex flex-column shadow-2 br3 h-100 overflow-hidden">

                <div class="ma0 pv3 ph4 bg-light-gray black flex items-center justify-between">
                    <h3 class="classname ma0 lh-solid pointer hover-blue" data-clipboard-text="">title</h3>
                    <div class="mq ml2"></div>
                    <div class="swatch ml-auto fw8 ma0 f3 lh-solid"></div>
                </div>

                <pre class="code overflow-x-auto flex-auto light-green bg-navy ma0 pv3 ph4">code</pre>

            </div>

        </article>
    </template>

    <template id="mq_template">
        , <span class="mq_item pointer gray hover-blue" data-clipboard-text=""> </span>
    </template>


    <div id="alert" class="dn fixed pv2 ph4 bg-green white b br3" style="top: 50%; left: 50%; transform: translate(-50%, -50%)">Copied!</div>

    <!-- ======== End body content ======== -->

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datalist-polyfill/1.22.1/datalist-polyfill.min.js"></script>
    <script>
        $(function () {

            var
                // Section that will contain our rules:
                $rules = $('#rules'),
                // HTML5 template for our rules:
                $rule_template = $('#rule_template').prop('content'),
                $mq_template = $('#mq_template').prop('content')
                ;
            //Array.prototype.forEach.call(document.styleSheets[0].cssRules, function (a) {
            Array.prototype.forEach.call($('#tachyons')[0].sheet.cssRules, function (a) {
                var
                    rule = a.cssText,
                    text = a.selectorText + '',
                    $rule_clone = $($rule_template).clone()
                    ;
                    //console.log(a.type);
                text = text.split(' ')[0].split(':')[0].replace('.', '').replace(',', '');
                if (rule.startsWith('.')) {

                    // Rules come in unformmated. Add newlines for readability.
                    rule = rule.replace(/(;|{)/g, '$1\n\t').replace('\t }', '}'); // add newlines

                    // set classname/title
                    $rule_clone
                        .find('.card')
                        .attr('id', text);
                    $rule_clone
                        .find('.classname')
                        .attr('data-clipboard-text', text)
                        .text(text);

                    // set code
                    $rule_clone.find('pre').text(rule);

                    // make a swatch if needed
                    var $swatch = $rule_clone.find('.swatch');
                    if (rule.startsWith('.bg-')) {
                        $swatch.addClass('dib w2 h2 ml1 shadow-2 ' + text);
                    }
                    if (rule.match(/\s+color:/g)) {
                        $swatch.addClass(text).text('Tt');
                    }
                    if (rule.match(/\s+border-color/g)) {
                        $swatch.addClass('dib w2 h2 ml1 ba bw2 ' + text);
                    }
                    if (rule.match(/\s+box-shadow/g)) {
                        $swatch.addClass('dib w2 h2 ml1 ' + text);
                    }
                    //$rules.append($('#template').html());
                    $rule_clone.appendTo('#rules');
                } else if (a.type == 4) {
                    // 4 == media query with cssRules array
                    Array.prototype.forEach.call(a.cssRules, function (b) {
                        // assume -* is the mq modifier
                        var id, mq, clipboard, $mq_node;
                        var $mq_clone = $($mq_template).clone();
                        id = b.selectorText.split(' ')[0].split(',')[0].split('-');
                        // Assume the last word is a mq mod
                        mq = id.pop().split('::before').join('').split('::after').join('');
                        //console.log(mq);
                        // reconstruct string and we should get a classname/id of a rule/card
                        id = id.join('-').replace('.', '#');
                        $mq_node = $(id).find('.mq')[0];
                        clipboard = id.replace('#', '') + '-' + mq;
                        // add mq if not already in there
                        if ($(id).find('.' + mq).length == 0){
                            $mq_clone.find('.mq_item')
                                .attr('data-clipboard-text', clipboard)
                                .addClass(mq).append('-' + mq)
                                .appendTo($mq_node);
                        };
                        //$(id).find('.mq').append(', <span class="pointer gray hover-blue" data-clipboard-text="'+ clipboard +'">-' + mq + '</span>');
                    });
                }
            });


            $("#filter").on('input keyup paste', function () {
                var filter = $(this).val().trim().replace(/ /g, '|');
                $("#rules .card").each(function () {
                    var $this = $(this);
                    if (($this.text()).match(new RegExp(filter, 'g'))) {
                        $this.css({ 'display': 'block' });
                    } else {
                        $this.css({ 'display': 'none' });
                    }
                });
            });
            $('#clear').click(function () {
                $('#filter').val('').focus().trigger('keyup');
            });


            var clipboard = new ClipboardJS('#rules [data-clipboard-text]');
            clipboard.on('success', function (e) {
                //console.info('Action:', e.action);
                //console.info('Text:', e.text);
                //console.info('Trigger:', e.trigger);
                e.clearSelection();
                $('#alert').text(e.text + ' copied!').fadeIn(200, function () {
                    $(this).fadeOut(1000);
                });

                $($('input[name="css"]:checked').val()).toggleClass(e.text);
            });
        });
    </script>
</body>

</html>